<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MEMORIA DI LAVORO Rotazione Mentale LIV.1 </title>


  <script src="./jspsych7.2.3/dist/jspsych.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-html-button-response.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-html-keyboard-response.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-image-button-response.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-survey-multi-choice.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-preload.js"></script>

  <link href="./jspsych7.2.3/dist/jspsych.css" rel="stylesheet" type="text/css" />
  <script src="jatos.js"></script>



</head>
<body>

    <!--
LIVELLO 1: Figure geometriche semplici in 3D; figure ad alta frequenza;
numero trials: (?)

LIVELLO 2: Figure geometriche semplici in 3D; Figure di media frequenza + aumento del numero di figure;
numero trials: (?)

LIVELLO 3: Figure geometriche di media difficoltà in 3D; Figure a bassa frequenza e simili tra loro;
numero trials: (?)
-->

</body>
<script>

    var jsPsych = initJsPsych({
        use_webaudio: false,
        on_finish: function() {
            /*jsPsych.data.displayData();*/
                var feed;
                if(punteggio >= 4){
                    var feed = 1;
                } else {
                    var feed = -1;
                }
                var  punteggio_dec = punteggio*10/5;
                jatos.studySessionData = feed;
                var memoria_lavoro = Number(sessionStorage.getItem('memoria_lavoro'))+feed;
                var counter_memoria_lavoro = Number(sessionStorage.getItem('counter_memoria_lavoro'))+1;
                var punteggio_finale_memoria_lavoro= Number(sessionStorage.getItem('punteggio_finale_memoria_lavoro'))+punteggio_dec;
                sessionStorage.setItem('punteggio_finale_memoria_lavoro', punteggio_finale_memoria_lavoro);
                if (memoria_lavoro < 0) {memoria_lavoro = 0}
                if (memoria_lavoro > 2) {memoria_lavoro = 2}
                if (counter_memoria_lavoro > 3) {counter_memoria_lavoro = 3}
                sessionStorage.setItem('memoria_lavoro', memoria_lavoro);
                sessionStorage.setItem('counter_memoria_lavoro', counter_memoria_lavoro);
                var Data = {feed: feed, type: 'MEMORIA_LAVORO_operazioni_level1', cresp: punteggio_dec};
                jatos.startComponentByPos(4,Data); //PER FAR COMPARIRE FEEDBACK in base a posizione file su jatos */
            }
          });

    var punteggio = 0
    var preload = {
        type: jsPsychPreload,
        images: [
            './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/1.png', './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/2.png',
            './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/3.png','./TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/4.png',
            './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/5.png', './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/6.png',
            './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/7.png', './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/8.png',
            './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/9.png','./TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/10.png',
            './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/11.png', './TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/12.png',
        ]
    };
    function shuffle(array) {
      array.sort(() => Math.random() - 0.5);
    };
    var angoliRotazione = [90, 180, 270]; // Esempio di array di valori di angolo in gradi
    var indiceAngolo = Math.floor(Math.random() * angoliRotazione.length);
    var angoloCasuale = angoliRotazione[indiceAngolo];
    let value =[1,2,3,4,5,6,7,8,9,10,11,12];
    shuffle(value);
    var pre_if = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p style="font-size: 34px; line-height: 1.5;"> Ora vedrai dei mattonicini che formano varie figure. <br>
          <strong>  Queste figure però sono state ruotate. </strong><br>Dovrà indicare quale tra alcune alternative rappresenta la figura che è stata ruotata</p>`,
        button_html:['<button class="jspsych-btn" style="font-size: 20px; color: white; background-color: blue; padding: 10px 20px; border: none; border-radius: 5px;">%choice%</button>','<button class="jspsych-btn" style="font-size: 20px; color: white; background-color: green; padding: 10px 20px; border: none; border-radius: 5px;">%choice%</button>'],
        choices: ['Premi qui per procedere al compito', 'Premi qui per fare una prova'],
        on_finish: function(data){
            if(data.response == 1){
                var risposta_prova = 1;
            } else{
                var risposta_prova = 0;
            }
            data.risposta_prova = risposta_prova
        }
    };

    var prova_loop = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size: 24px; ">Tra le tre alternative di risposta solo una corrisponde a quella ruotata,<br> mentre le altre due sono immagini diverse. <br>Quale delle tre immagini sotto corrisponde a quella ruotata in alto?
                <div style="height: 300px; width: 300px; background-image: url('./TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/`+value[0]+`.png'); background-size: contain; background-repeat: no-repeat; background-position:center;margin-left:40%; transform: rotate(`+angoloCasuale+`deg)"></div><br><br>`,
      choices: "NO_KEYS",
      choices:["", "", ""],
      prompt: `<p style="font-size: 24px; ">Clicca sull'immagine corretta.</p>`,
      button_html:[
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[0]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[1]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[2]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
    ],
      randomize_choices_order: true,
      on_finish: function(data){
          if(data.response == 0 ){
              var accuracy = true;
          } else {
              var accuracy = false;
          }
          data.accuracy = accuracy
      }
    };

    var feedback = {
        type: jsPsychHtmlKeyboardResponse,
        choices: "NO_KEYS",
        trial_duration: 1500,
        data:"",
        stimulus: "",
        on_start: function(prova_loop){
            var last_response_accuracy = jsPsych.data.getLastTrialData().values()[0].accuracy;;
            if (last_response_accuracy == true) {
                var feedback = "<img src='feedback/img/corretto.png' width='300'></img>";
                console.log("Corretto")
            } else {
                var feedback = "<img src='feedback/img/sbagliato.png' width='300'></img>";
                console.log("Sbagliato")
            };
            var feedback_prova_stima = "<div style='font-size:60px'><b>" + feedback +"</b></div>";
            prova_loop.data = {stimulus: feedback};
            prova_loop.stimulus = feedback_prova_stima;
        },

    };

    var begin_trial = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p style="font-size: 34px; line-height: 1.5;"> Allora proseguiamo, inziamo con il vero esercizio. <br>
                  Ora vedrai dei mattonicini che formano varie figure. <br>
                  <strong>  Queste figure però sono state ruotate. </strong><br>
                  Dovrà indicare quale tra alcune alternative rappresenta la figura che è stata ruotata </p>`,
        button_html:['<button class="jspsych-btn" style="font-size: 20px; color: white; background-color: green; padding: 10px 20px; border: none; border-radius: 5px;">%choice%</button>'],
        choices: ['Premi qui per iniziare']
    };

    var trial1 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p style="font-size: 24px; ">Tra le tre alternative di risposta solo una corrisponde a quella ruotata,<br> mentre le altre due sono immagini diverse. <br>Quale delle tre immagini sotto corrisponde a quella ruotata in alto?
        <div style="height: 300px; width: 300px; background-image: url('./TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/`+value[1]+`.png'); background-size: contain; background-repeat: no-repeat; background-position:center;margin-left:40%; transform: rotate(`+angoloCasuale+`deg)"></div><br><br>`,
        choices: "NO_KEYS",
        choices:["", "", ""],
        prompt: `<p style="font-size: 24px; ">Clicca sull'immagine corretta.</p>`,
        button_html:[
        '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[1]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
        '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[3]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
        '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[4]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
        ],
        randomize_choices_order: true,
        on_finish: function(data){
            if(data.response ==  0){
                punteggio++;
                console.log("punteggio", punteggio)
            } else {
                console.log("punteggio", punteggio)

            }

        }

    };

    var trial2 = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size: 24px; ">Tra le tre alternative di risposta solo una corrisponde a quella ruotata,<br> mentre le altre due sono immagini diverse. <br>Quale delle tre immagini sotto corrisponde a quella ruotata in alto?
      <div style="height: 300px; width: 300px; background-image: url('./TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/`+value[2]+`.png'); background-size: contain; background-repeat: no-repeat; background-position:center;margin-left:40%; transform: rotate(`+angoloCasuale+`deg)"></div><br><br>`,
      choices: "NO_KEYS",
      choices:["", "", ""],
      prompt: `<p style="font-size: 24px; ">Clicca sull'immagine corretta.</p>`,
      button_html:[
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[2]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[6]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[5]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
    ],
        randomize_choices_order: true,
        on_finish: function(data){
            if(data.response ==  0){
                console.log("punteggio", punteggio)
                punteggio++;
            } else {
                console.log("punteggio", punteggio)

            }

        }

    };

    var trial3 = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size: 24px; ">Tra le tre alternative di risposta solo una corrisponde a quella ruotata,<br> mentre le altre due sono immagini diverse. <br>Quale delle tre immagini sotto corrisponde a quella ruotata in alto?
      <div style="height: 300px; width: 300px; background-image: url('./TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/`+value[3]+`.png'); background-size: contain; background-repeat: no-repeat; background-position:center;margin-left:40%; transform: rotate(`+angoloCasuale+`deg)"></div><br><br>`,
      choices: "NO_KEYS",
      choices:["", "", ""],
      prompt: `<p style="font-size: 24px; ">Clicca sull'immagine corretta.</p>`,
      button_html:[
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[7]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[3]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[8]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
    ],
        randomize_choices_order: true,
        on_finish: function(data){
            if(data.response ==  1){
                punteggio++;
                console.log("punteggio", punteggio)
            } else {
                console.log("punteggio", punteggio)

            }

        }

    };

    var trial4 = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size: 24px; ">Tra le tre alternative di risposta solo una corrisponde a quella ruotata,<br> mentre le altre due sono immagini diverse. <br>Quale delle tre immagini sotto corrisponde a quella ruotata in alto?
      <div style="height: 300px; width: 300px; background-image: url('./TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/`+value[4]+`.png'); background-size: contain; background-repeat: no-repeat; background-position:center;margin-left:40%; transform: rotate(`+angoloCasuale+`deg)"></div><br><br>`,
      choices: "NO_KEYS",
      choices:["", "", ""],
      prompt: `<p style="font-size: 24px; ">Clicca sull'immagine corretta.</p>`,
      button_html:[
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[9]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[10]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[4]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
    ],
        randomize_choices_order: true,
        on_finish: function(data){
            if(data.response ==  2){
                punteggio++;
                console.log("punteggio", punteggio)

            } else {
                console.log("punteggio", punteggio)

            }

        }

    };

    var trial5 = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size: 24px; ">Tra le tre alternative di risposta solo una corrisponde a quella ruotata,<br> mentre le altre due sono immagini diverse. <br>Quale delle tre immagini sotto corrisponde a quella ruotata in alto?
      <div style="height: 300px; width: 300px; background-image: url('./TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/`+value[5]+`.png'); background-size: contain; background-repeat: no-repeat; background-position:center;margin-left:40%; transform: rotate(`+angoloCasuale+`deg)"></div><br><br>`,
      choices: "NO_KEYS",
      choices:["", "", ""],
      prompt: `<p style="font-size: 24px; ">Clicca sull'immagine corretta.</p>`,
      button_html:[
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[11]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[0]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
      '<button class="jspsych-btn" style = "height:190px; width:200px; background: url(TASKS/MEMORIA_LAVORO/rotazione_mentale/img/img3/'+value[5]+'.png); background-size: contain; background-repeat: no-repeat; background-position: center;%;">%choice%</button>',
    ],
        randomize_choices_order: true,
        on_finish: function(data){
            if(data.response ==  2){
                punteggio++;
                console.log("punteggio", punteggio)
            } else {
                console.log("punteggio", punteggio)

            }

        }

    };
    var sample_trials = jsPsych.randomization.sampleWithoutReplacement([
        { timeline: [trial1] },
        { timeline: [trial2] },
        { timeline: [trial3] },
        { timeline: [trial4] },
        { timeline: [trial5] }
    ]);


    var trial_timeline = {
      timeline: sample_trials
    };


    var if_node = {
        timeline: [begin_trial,trial_timeline],
        conditional_function: function(){
            var response_button = jsPsych.data.get().last(1).values()[0].risposta_prova;
            if (response_button == 0){
                console.log("prosegui a esercizio");
                return true;
            } else {
                console.log("inizia la prova");
                jsPsych.addNodeToEndOfTimeline(loop_prova)
                return false;
            }
        }
    };

    var begin_loop = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p style="font-size: 34px; line-height: 1.5;"> Va bene facciamo una prova! <br>
        Ora vedrai dei mattonicini che formano varie figure. <br>
        <strong>  Queste figure però sono state ruotate. </strong><br>
        Dovrà indicare quale tra alcune alternative rappresenta la figura che è stata ruotata </p>`,
        button_html:['<button class="jspsych-btn" style="font-size: 20px; color: white; background-color: green; padding: 10px 20px; border: none; border-radius: 5px;">%choice%</button>'],
        choices: ['Premi qui per iniziare la prova'],
        on_start: function(data){
            var response_button = jsPsych.data.get().last(1).values()[0].response;
            console.log(response_button)
            if (response_button == 0){
                console.log("salta loop");
                jsPsych.endCurrentTimeline(); /*Ends the current timeline. If timelines are nested, then only the timeline that contains the current trial is ended.*/
            }
        }
    };

    var end_loop_prova = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p style="font-size: 34px; line-height: 1.5;"> Ora che ha terminato la prova, inziamo con il vero esercizio. <br>
        Ora vedrai dei mattonicini che formano varie figure. <br>
        <strong>  Queste figure però sono state ruotate. </strong><br>
        Dovrà indicare quale tra alcune alternative rappresenta la figura che è stata ruotata </p>`,
        button_html:['<button class="jspsych-btn" style="font-size: 20px; color: white; background-color: blue; padding: 10px 20px; border: none; border-radius: 5px;">%choice%</button>','<button class="jspsych-btn" style="font-size: 20px; color: white; background-color: green; padding: 10px 20px; border: none; border-radius: 5px;">%choice%</button>'],
        choices: ['Premi qui per proseguire', 'Premi qui per ripetere la prova'],
        on_finish: function(data){
            if(data.response == 1){
                var risposta = 1;
            } else{
                var risposta = 0;
                console.log("Termine loop prova");
                jsPsych.addNodeToEndOfTimeline(trial_timeline);
            }
            data.risposta_loop = risposta
        }
    };

    var loop_prova = {
        timeline: [begin_loop, prova_loop, feedback, end_loop_prova],
        loop_function: function(){
            var response_button = jsPsych.data.get().last(1).values()[0].risposta_loop;
            if (response_button == 1){
                return true;
            } else {
                return false; /*IMPORTANTE: mantenere l'ordine in cui sono stati inseriti gli elementi*/
            }
        }
    };

    var timeline = [pre_if, if_node]
jsPsych.run(timeline)

</script>
</html>
